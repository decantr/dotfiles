#!/bin/sh
#
# tool to generate the "status bar" of dwm
#
# original author : luke smith ( lukesmith.xyz )
# original source : https://github.com/LukeSmithxyz/voidrice/blob/voiddwm/.local/bin/dwmbar

status() { \

	# get current mpd track filename or artist - title if possible.
	( mpc > /dev/null ) &&
	printf "[ %s ] |" "$(mpc -f "[[%artist% - ]%title%]|[%file%]" 2>/dev/null | grep -v "volume:" | head -n 1)"

	# Get the volume of ALSA's master volume output or the level from
	# pulse and show the level show an icon if or not muted.
	if [ $(pulsemixer --get-mute) = 1 ]; then
		printf "  |"
	else
		vol="$(pulsemixer --get-volume | awk '{print $1}')"
		case "$vol" in
 			0|1[0-9]|2[0-9]) printf "  %s%% |" "$vol";;
			100|9[0-9]|8[0-9]|7[0-9]) printf "  %s%% |" "$vol";;
			*) printf "  %s%% |" "$vol";;
		esac;
	fi

	# wifi quality percentage and  icon if ethernet is connected.
	printf "%s%s " \
		"$(grep "^\s*w" /proc/net/wireless | awk '{ print " ", int($3 * 100 / 70) "%" }')" \
		"$(sed "s/down//;s/up/ /" /sys/class/net/e*/operstate)"

	if [ -f /sys/class/power_supply/BAT0/capacity ]; then
		printf "| "

		# will show all batteries with approximate icon for remaining power.
		case "$(cat /sys/class/power_supply/BAT0/capacity)" in
			100|9[0-9])	printf "" ;;
			8[0-9]|7[0-9])	printf "" ;;
			6[0-9]|5[0-9])	printf "" ;;
			4[0-9]|3[0-9])	printf "" ;;
			*)		printf "" ;;
		esac;

		# print percentage
		printf " %s%% " "$(cat /sys/class/power_supply/BAT0/capacity)"
	fi

	# show unread mail if mutt-wizard is installed.
	command -v mw >/dev/null 2>&1 &&
		printf "|  %s " "$(du -a ~/.local/share/mail/*/INBOX/new/* 2>/dev/null | wc -l)"

	printf "| %s" "$(date '+%b %d %H:%M')"
}

while :; do
	xsetroot -name "$(status | tr '\n' ' ')"
	sleep 1m
done
